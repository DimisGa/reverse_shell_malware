#from socket import socket, gethostname, SHUT_WR
import socket
import cv2

### 	CONNECTION PART AND SENDING THE VIDEO FILE TO SERVER  ####


def read_file():
    s = socket.socket()
    host = '192.168.2.2'
    port = 6666
    s.connect((host, port))

    print("Sending video..")

    with open('output.avi', 'rb') as video:
        buffer = video.read()

        s.sendall(buffer)

    print("Done sending..")
    s.close()


###### VIDEO CAPTURE PART ######
cap = cv2.VideoCapture(0)
cv2.resizeWindow('frame', 300, 300)
fourcc = cv2.VideoWriter_fourcc(*'XVID')
out = cv2.VideoWriter('output.avi', fourcc, 20.0, (300, 300))


def video_capture():
    while (cap.isOpened()):
        ret, frame = cap.read()
        if ret:
            # create vidout funct. with res=300x300
            vidout = cv2.resize(frame, (300, 300))
            out.write(vidout)  # write frames of vidout function
            cv2.imshow('frame', frame)

            if cv2.waitKey(1) & 0xFF == ord('q'):
                cap.release()
                out.release()
                cv2.destroyAllWindows()
                read_file()
                break


'''

s = socket.socket()
host = '192.168.2.2'
port = 6666

s.connect((host, port))

print("Sending video..")

with open('output.avi', 'rb') as video:
    buffer = video.read()
    
    s.sendall(buffer)

print("Done sending..")
s.close()
'''
